<script>
function generateCard() {
    const hasSelection = Object.values(optionCounts).some(count => count > 0);

    if (!hasSelection) {
        showError('Начни с чего-нибудь, а дальше дело пойдет!');
        return;
    }

    if (tokens > 0) {
        showError('У тебя еще есть токены, выбери еще что-нибудь! ;)');
        return;
    }

    const qrText = Object.entries(optionCounts)
        .filter(([code, count]) => count > 0)
        .map(([code, count]) => `${code}:${count}`)
        .join(',');

    const cardResult = document.getElementById('cardResult');
    cardResult.innerHTML = `
        <div class="card-wrapper">
            <p>Покажи мне QR код с открытки, и дальше дело за мной :)</p>
            <div class="image-container">
                <img src="images/qr.jpg" alt="Праздничная рамка" class="card-image">
                <div id="qrcode-container" style="position: absolute; top: 35.4%; left: 35.4%; width: 29.3%; height: 29.3%;">
                    <div id="qrcode" style="width: 100%; height: 100%;"></div>
                </div>
            </div>
        </div>
    `;

    // Генерация QR-кода с использованием 100% размеров родительского контейнера
    new QRCode(document.getElementById("qrcode"), {
        text: qrText,
        width: document.getElementById("qrcode").offsetWidth,
        height: document.getElementById("qrcode").offsetHeight,
        colorDark: "#2a9d8f",
        colorLight: "#ffffff"
    });

    disableButtons(true);
    const generateButton = document.getElementById("generateButton");
    generateButton.innerText = "Начать заново";
    generateButton.setAttribute("onclick", "resetForm()");
}
</script>
